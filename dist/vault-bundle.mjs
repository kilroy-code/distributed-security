function e({target:e,receiver:r=e,namespace:t=r,origin:n=e!==r&&e.location.origin,log:s=(()=>null),warn:a=console.warn.bind(console),error:i=console.error.bind(console)}){let o={},c=0,g="2.0",l=n||e,d=e.postMessage.bind(e),m=n?e=>d(e,n):d;return s("dispatch to",l),r.addEventListener("message",(async r=>{s("message",r.data,"from",r.origin||l);let{id:c,method:d,params:p=[],result:u,error:y,jsonrpc:f}=r.data||{};if(r.source&&r.source!==e)return i("mismatched target:",e,r.source);if(n&&n!==r.origin)return i("mismatched origin",n,r.origin);if(f!==g)return a(`Ignoring non-jsonrpc message ${JSON.stringify(r.data)}.`);if(d){let e,r=null,n=Array.isArray(p)?p:[p];try{e=await t[d](...n)}catch(e){r=function(e){let{name:r,message:t}=e;return{name:r,message:t}}(e),t[d]||r.message.includes(d)?r.message||(r.message=`${r.name||r.toString()} in ${d}.`):r.message=`${d} is not defined.`}let a=r?{id:c,error:r,jsonrpc:g}:{id:c,result:e,jsonrpc:g};return s("answering",c,r||e,"to",l),m(a)}let h=o[c];if(delete o[c],!h)return console.log(`Ignoring response ${r.data}.`);y?h.reject(y):h.resolve(u)})),function(e,...r){let t=++c,n=o[t]={};return new Promise(((a,i)=>{Object.assign(n,{resolve:a,reject:i}),s("posting",t,e,r,"to",l),m({id:t,method:e,params:r,jsonrpc:g})}))}}const r=import.meta.url,t={sign:(e,...r)=>o("sign",e,...r),verify:(e,...r)=>o("verify",e,...r),encrypt:(e,...r)=>o("encrypt",e,...r),decrypt:(e,...r)=>o("decrypt",e,...r),create:(...e)=>o("create",...e),changeMembership:e=>o("changeMembership",e),destroy:e=>o("destroy",e),clear:e=>o("clear",e)},n={store:(e,r,t)=>a("store",e,r,t),retrieve:(e,r)=>a("retrieve",e,r),getUserDeviceSecret:(e,r="")=>a("getUserDeviceSecret",e,r),ready(e){a("ready",e)}},s=document.referrer?new URL(document.referrer).origin:"*",a=e({dispatcherLabel:r,target:parent,targetLabel:"entry",receiver:self,namespace:t,origin:s}),i=new URL("worker-bundle.mjs",r),o=e({dispatcherLabel:r,target:new Worker(i,{type:"module"}),targetLabel:"worker",namespace:n});
