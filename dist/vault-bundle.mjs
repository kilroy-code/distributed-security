function e({target:e,receiver:r=e,namespace:t=r,origin:n=e!==r&&e.location.origin,log:s=(()=>null),warn:a=console.warn.bind(console),error:o=console.error.bind(console)}){let i={},c=0,g="2.0",l=n||e,m=e.postMessage.bind(e),d=n?e=>m(e,n):m;return s("dispatch to",l),r.addEventListener("message",(async r=>{s("message",r.data,"from",r.origin||l);let{id:c,method:m,params:p=[],result:u,error:f,jsonrpc:y}=r.data||{};if(r.source&&r.source!==e)return o("mismatched target:",e,r.source);if(n&&n!==r.origin)return o("mismatched origin",n,r.origin);if(y!==g)return a(`Ignoring non-jsonrpc message ${JSON.stringify(r.data)}.`);if(m){let e,r=null,n=Array.isArray(p)?p:[p];try{e=await t[m](...n)}catch(e){r=function(e){let{name:r,message:t}=e;return{name:r,message:t}}(e),t[m]||r.message.includes(m)?r.message||(r.message=`${r.name||r.toString()} in ${m}.`):r.message=`${m} is not defined.`}let a=r?{id:c,error:r,jsonrpc:g}:{id:c,result:e,jsonrpc:g};return s("answering",c,r||e,"to",l),d(a)}let h=i[c];if(delete i[c],!h)return console.log(`Ignoring response ${r.data}.`);f?h.reject(f):h.resolve(u)})),function(e,...r){let t=++c,n=i[t]={};return new Promise(((a,o)=>{Object.assign(n,{resolve:a,reject:o}),s("posting",t,e,r,"to",l),d({id:t,method:e,params:r,jsonrpc:g})}))}}const r=self.name.split("@")[1];onmessage=t=>{if(t.source!==parent||t.origin!==new URL(document.referrer).origin)return alert(`${self.name} got ${t.data} from ${t.origin}.`);onmessage=null;const n="entry@"+r,s={sign:(e,...r)=>l("sign",e,...r),verify:(e,...r)=>l("verify",e,...r),encrypt:(e,...r)=>l("encrypt",e,...r),decrypt:(e,...r)=>l("decrypt",e,...r),create:(...e)=>l("create",...e),changeMembership:e=>l("changeMembership",e),destroy:e=>l("destroy",e),clear:e=>l("clear",e)},a=e({target:t.ports[0],targetLabel:n,dispatcherLabel:self.name,namespace:s}),o=import.meta.url,i=new URL("worker-bundle.mjs?v=54",o),c="worker@"+r,g={store:(e,r,t)=>a("store",e,r,t),retrieve:(e,r)=>a("retrieve",e,r),getUserDeviceSecret:(e,r="")=>a("getUserDeviceSecret",e,r),ready(e){t.ports[0].start(),a("ready",e)}},l=e({target:new Worker(i,{type:"module",name:c}),targetLabel:c,dispatcherLabel:self.name,namespace:g})};
