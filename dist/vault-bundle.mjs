function e({target:e=self,receiver:r=e,namespace:t=r,origin:n=e!==r&&e.location.origin,dispatcherLabel:a=t.name||r.name||r.location?.href||r,targetLabel:s=e.name||n||e.location?.href||e,log:o=null,info:i=console.info.bind(console),warn:c=console.warn.bind(console),error:l=console.error.bind(console)}){const g={},d="2.0",m=e.postMessage.bind(e),u=n?e=>m(e,n):m;let p=0;return r.addEventListener("message",(async function(r){o?.(a,"got message",r.data,"from",s,r.origin);let{id:i,method:m,params:p=[],result:f,error:y,jsonrpc:b}=r.data||{};if(r.source&&r.source!==e)return l?.(a,"to",s,"got message from",r.source);if(n&&n!==r.origin)return l?.(a,n,"mismatched origin",s,r.origin);if(b!==d)return c?.(`${a} ignoring non-jsonrpc message ${JSON.stringify(r.data)}.`);if(m){let e,r=null,n=Array.isArray(p)?p:[p];try{e=await t[m](...n)}catch(e){r=function(e){let{name:r,message:t,code:n,data:a}=e;return{name:r,message:t,code:n,data:a}}(e),t[m]||r.message.includes(m)?r.message||(r.message=`${r.name||r.toString()} in ${m}.`):(r.message=`${m} is not defined.`,r.code=-32601)}if(void 0===i)return;let c=r?{id:i,error:r,jsonrpc:d}:{id:i,result:e,jsonrpc:d};return o?.(a,"answering",i,r||e,"to",s),u(c)}let h=g[i];if(delete g[i],!h)return c?.(`${a} ignoring response ${r.data}.`);y?h.reject(y):h.resolve(f)})),i?.(`${a} will dispatch to ${s}`),function(e,...r){let t=++p,n=g[t]={};return new Promise(((i,c)=>{o?.(a,"request",t,e,r,"to",s),Object.assign(n,{resolve:i,reject:c}),u({id:t,method:e,params:r,jsonrpc:d})}))}}onmessage=r=>{onmessage=null;const t=r.data,n="vault!"+t,a="entry!"+t,s={sign:(e,...r)=>g("sign",e,...r),verify:(e,...r)=>g("verify",e,...r),encrypt:(e,...r)=>g("encrypt",e,...r),decrypt:(e,...r)=>g("decrypt",e,...r),create:(...e)=>g("create",...e),changeMembership:e=>g("changeMembership",e),destroy:e=>g("destroy",e),clear:e=>g("clear",e)},o=e({target:r.ports[0],targetLabel:a,dispatcherLabel:n,namespace:s}),i=import.meta.url,c=new URL("worker-bundle.mjs",i),l="worker!"+t,g=e({target:new Worker(c,{type:"module",name:l}),targetLabel:l,dispatcherLabel:n,namespace:{store:(e,r,t)=>o("store",e,r,t),retrieve:(e,r)=>o("retrieve",e,r),getUserDeviceSecret:(e,r="")=>o("getUserDeviceSecret",e,r),ready(e){r.ports[0].start(),o("ready",e)}}})};
